// IIFE để đảm bảo mã chạy ngay lập tức và không gây xung đột biến toàn cục
!function (e) {
    "use strict"; // Chạy mã ở chế độ strict để tránh lỗi cú pháp không mong muốn

    e(window); // Gọi jQuery với đối tượng window (không rõ mục đích cụ thể, có thể không cần thiết)
    var i, s, r, n, t, a = e("body"); // Lưu tham chiếu đến body

    // Sticky header: Thêm class "sticky" khi cuộn trang xuống quá 100px
    e(window).on("scroll", function () {
        e(window).scrollTop() < 100 ? e(".sticky-header").removeClass("sticky") : e(".sticky-header").addClass("sticky");
    });

    // Sticky bar riêng biệt: Tương tự sticky header, thêm class "sticky" cho .seperate-sticky-bar
    e(window).on("scroll", function () {
        e(window).scrollTop() < 100 ? e(".seperate-sticky-bar").removeClass("sticky") : e(".seperate-sticky-bar").addClass("sticky");
    });

    // Mở form tìm kiếm khi click vào link có href="#search"
    e('a[href="#search"]').on("click", function (i) {
        i.preventDefault(); // Ngăn hành vi mặc định của thẻ a
        e("#search").addClass("open"); // Mở form tìm kiếm
        e('#search > form > input[type="search"]').focus(); // Focus vào input tìm kiếm
    });

    // Đóng form tìm kiếm khi click nút close
    e("#search, #search button.close").on("click", function (i) {
        if ("close" == i.target.className) { // Chỉ đóng nếu click vào nút có class "close"
            e(this).removeClass("open"); // Ẩn form tìm kiếm
        }
    });

    // Khởi tạo biến cho offcanvas (menu hoặc sidebar ẩn)
    i = e(".offcanvas-toggle"); // Nút toggle offcanvas
    s = e(".offcanvas"); // Container offcanvas
    r = e(".offcanvas-overlay"); // Lớp phủ overlay
    n = e(".mobile-menu-toggle"); // Nút toggle menu trên mobile

    // Mở offcanvas khi click nút toggle
    i.on("click", function (i) {
        i.preventDefault(); // Ngăn hành vi mặc định
        var s = e(this), n = s.attr("href"); // Lấy ID của offcanvas từ href
        a.addClass("offcanvas-open"); // Thêm class để mở offcanvas
        e(n).addClass("offcanvas-open"); // Mở offcanvas cụ thể
        r.fadeIn(); // Hiển thị overlay
        s.parent().hasClass("mobile-menu-toggle") && s.addClass("close"); // Nếu là menu mobile, thêm class "close" vào nút toggle
    });

    // Đóng offcanvas khi click nút đóng hoặc overlay
    e(".offcanvas-close, .offcanvas-overlay").on("click", function (e) {
        e.preventDefault();
        a.removeClass("offcanvas-open"); // Đóng offcanvas
        s.removeClass("offcanvas-open"); // Đóng tất cả offcanvas
        r.fadeOut(); // Ẩn overlay
        n.find("a").removeClass("close"); // Xóa class "close" khỏi nút toggle
    });

    // Xử lý menu offcanvas (menu con trên mobile)
    t = e(".offcanvas-menu"); // Container menu offcanvas
    t.find(".mobile-sub-menu").parent().prepend('<div class="offcanvas-menu-expand"></div>'); // Thêm nút expand cho menu con

    t.on("click", "li a, .offcanvas-menu-expand", function (i) {
        var s = e(this);
        // Nếu click vào link "#" hoặc nút expand
        if ("#" === s.attr("href") || s.hasClass("offcanvas-menu-expand")) {
            i.preventDefault();
            if (s.siblings("ul:visible").length) { // Nếu menu con đang hiển thị
                s.parent("li").removeClass("active"); // Đóng menu cha
                s.siblings("ul").slideUp(); // Ẩn menu con
                s.parent("li").find("li").removeClass("active"); // Đóng các menu con khác
                s.parent("li").find("ul:visible").slideUp(); // Ẩn các menu con khác
            } else { // Nếu menu con đang ẩn
                s.parent("li").addClass("active"); // Mở menu cha
                s.closest("li").siblings("li").removeClass("active").find("li").removeClass("active"); // Đóng các menu khác
                s.closest("li").siblings("li").find("ul:visible").slideUp(); // Ẩn menu con của các menu khác
                s.siblings("ul").slideDown(); // Hiển thị menu con
            }
        }
    });

    // Khởi tạo niceSelect cho các thẻ select
    e("select").niceSelect();

    // Khởi tạo Swiper cho hero slider (slider chính trên trang chủ)
    new Swiper(".hero-slider-active.swiper-container", {
        slidesPerView: 1, // Hiển thị 1 slide mỗi lần
        effect: "fade", // Hiệu ứng chuyển slide dạng fade
        speed: 1500, // Tốc độ chuyển slide (1500ms)
        watchSlidesProgress: true, // Theo dõi tiến trình slide
        loop: true, // Lặp lại slider
        autoplay: false, // Không tự động chạy
        pagination: { el: ".swiper-pagination", clickable: true }, // Hiển thị pagination
        navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" } // Nút điều hướng
    });

    // Swiper cho slider sản phẩm (4 cột, 2 hàng)
    new Swiper(".product-default-slider-4grid-2row.swiper-container", {
        slidesPerView: 4, // Hiển thị 4 slide mỗi lần
        spaceBetween: 30, // Khoảng cách giữa các slide
        speed: 1500,
        slidesPerColumn: 2, // Hiển thị 2 hàng
        slidesPerColumnFill: "row", // Điền slide theo hàng
        navigation: { nextEl: ".product-slider-default-2rows .swiper-button-next", prevEl: ".product-slider-default-2rows .swiper-button-prev" },
        breakpoints: { // Responsive
            0: { slidesPerView: 1 },
            576: { slidesPerView: 2 },
            768: { slidesPerView: 2 },
            992: { slidesPerView: 3 },
            1200: { slidesPerView: 4 }
        }
    });

    // Swiper cho slider sản phẩm (4 cột, 1 hàng)
    new Swiper(".product-default-slider-4grid-1row.swiper-container", {
        slidesPerView: 4,
        spaceBetween: 30,
        speed: 1500,
        navigation: { nextEl: ".product-slider-default-1row .swiper-button-next", prevEl: ".product-slider-default-1row .swiper-button-prev" },
        breakpoints: {
            0: { slidesPerView: 1 },
            576: { slidesPerView: 2 },
            768: { slidesPerView: 2 },
            992: { slidesPerView: 3 },
            1200: { slidesPerView: 4 }
        }
    });

    // Swiper cho slider sản phẩm dạng danh sách (4 cột, 3 hàng)
    new Swiper(".product-listview-slider-4grid-3rows.swiper-container", {
        slidesPerView: 4,
        spaceBetween: 30,
        speed: 1500,
        slidesPerColumn: 3,
        slidesPerColumnFill: "row",
        navigation: { nextEl: ".product-list-slider-3rows .swiper-button-next", prevEl: ".product-list-slider-3rows .swiper-button-prev" },
        breakpoints: {
            0: { slidesPerView: 1 },
            640: { slidesPerView: 2 },
            768: { slidesPerView: 2 },
            992: { slidesPerView: 3 },
            1200: { slidesPerView: 4 }
        }
    });

    // Swiper cho slider blog (3 cột)
    new Swiper(".blog-slider.swiper-container", {
        slidesPerView: 3,
        spaceBetween: 30,
        speed: 1500,
        navigation: { nextEl: ".blog-default-slider .swiper-button-next", prevEl: ".blog-default-slider .swiper-button-prev" },
        breakpoints: {
            0: { slidesPerView: 1 },
            576: { slidesPerView: 2 },
            768: { slidesPerView: 2 },
            992: { slidesPerView: 3 }
        }
    });

    // Swiper cho slider logo công ty (7 cột)
    new Swiper(".company-logo-slider.swiper-container", {
        slidesPerView: 7,
        speed: 1500,
        navigation: { nextEl: ".company-logo-slider .swiper-button-next", prevEl: ".company-logo-slider .swiper-button-prev" },
        breakpoints: {
            0: { slidesPerView: 1 },
            480: { slidesPerView: 2 },
            768: { slidesPerView: 3 },
            992: { slidesPerView: 3 },
            1200: { slidesPerView: 7 }
        }
    });

    // Swiper cho hình ảnh sản phẩm (thumbnail ngang)
    var l = new Swiper(".product-image-thumb-horizontal.swiper-container", {
        loop: true,
        speed: 1000,
        spaceBetween: 25,
        slidesPerView: 4,
        freeMode: true,
        watchSlidesVisibility: true,
        watchSlidesProgress: true,
        navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" }
    });

    // Swiper cho hình ảnh lớn của sản phẩm (ngang)
    new Swiper(".product-large-image-horaizontal.swiper-container", {
        slidesPerView: 1,
        speed: 1500,
        thumbs: { swiper: l } // Liên kết với thumbnail
    });

    // Swiper cho hình ảnh sản phẩm (thumbnail dọc)
    var o = new Swiper(".product-image-thumb-vartical.swiper-container", {
        direction: "vertical",
        centeredSlidesBounds: true,
        slidesPerView: 4,
        watchOverflow: true,
        watchSlidesVisibility: true,
        watchSlidesProgress: true,
        spaceBetween: 25,
        freeMode: true,
        navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" }
    });

    // Swiper cho hình ảnh lớn của sản phẩm (dọc)
    new Swiper(".product-large-image-vartical.swiper-container", {
        slidesPerView: 1,
        speed: 1500,
        thumbs: { swiper: o }
    });

    // Swiper cho slider hình ảnh sản phẩm đơn
    var d = new Swiper(".product-image-single-slide.swiper-container", {
        loop: true,
        speed: 1000,
        spaceBetween: 25,
        slidesPerView: 4,
        navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
        breakpoints: {
            0: { slidesPerView: 1 },
            576: { slidesPerView: 2 },
            768: { slidesPerView: 3 },
            992: { slidesPerView: 4 },
            1200: { slidesPerView: 4 }
        }
    });

    // Swiper cho hình ảnh thumbnail trong modal
    new Swiper(".modal-product-image-thumb", {
        spaceBetween: 10,
        slidesPerView: 4,
        freeMode: true,
        watchSlidesVisibility: true,
        watchSlidesProgress: true,
        navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" }
    });

    // Swiper cho hình ảnh lớn trong modal
    new Swiper(".modal-product-image-large", {
        thumbs: { swiper: d }
    });

    // Swiper cho slider blog dạng danh sách
    new Swiper(".blog-list-slider.swiper-container", {
        loop: true,
        speed: 1000,
        slidesPerView: 1,
        navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" }
    });

    // Khởi tạo zoom cho hình ảnh sản phẩm
    e(".zoom-image-hover").zoom();

    // Khởi tạo thanh trượt giá (price range slider)
    e("#slider-range").slider({
        range: true,
        min: 0,
        max: 500,
        values: [75, 300], // Giá trị mặc định
        slide: function (i, s) {
            e("#amount").val("$" + s.values[0] + " - $" + s.values[1]); // Cập nhật giá trị hiển thị
        }
    });
    e("#amount").val("$" + e("#slider-range").slider("values", 0) + " - $" + e("#slider-range").slider("values", 1)); // Hiển thị giá trị ban đầu

    // Khởi tạo AOS (Animate On Scroll)
    AOS.init({
        duration: 1000, // Thời gian hiệu ứng (1000ms)
        once: true, // Chỉ chạy hiệu ứng 1 lần
        easing: "ease" // Kiểu easing
    });
    window.addEventListener("load", AOS.refresh); // Refresh AOS khi trang tải xong

    // Khởi tạo Venobox cho nút phát video
    e(".video-play-btn").venobox();

    // Khởi tạo Material Scroll Top (nút quay về đầu trang)
    e("body").materialScrollTop();

    // Hiển thị thông báo toast khi trang tải xong
    e(window).on("load", function () {
        // Lấy dữ liệu thông báo từ các input ẩn
        const i = e("input[name=msgType1_5s]").val(), // Loại thông báo (1.5 giây)
            s = e("input[name=msg1_5s]").val(), // Nội dung thông báo (1.5 giây)
            r = e("input[name=msgType3s]").val(), // Loại thông báo (3 giây)
            n = e("input[name=msg3s]").val(), // Nội dung thông báo (3 giây)
            t = e("input[name=msgType5s]").val(), // Loại thông báo (5 giây)
            a = e("input[name=msg5s]").val(); // Nội dung thông báo (5 giây)

        // Kiểm tra và hiển thị thông báo (ưu tiên thời gian ngắn hơn)
        if ("" == i || "" == s) { // Nếu không có thông báo 1.5 giây
            if ("" == r || "" == n) { // Nếu không có thông báo 3 giây
                if ("" == t || "" == a); // Nếu không có thông báo 5 giây, không làm gì
                else { // Hiển thị thông báo 5 giây
                    const e = Swal.mixin({
                        toast: true,
                        position: "top",
                        showConfirmButton: false,
                        timer: 2500,
                        didOpen: e => {
                            e.addEventListener("mouseenter", Swal.stopTimer);
                            e.addEventListener("mouseleave", Swal.resumeTimer);
                        }
                    });
                    switch (t) {
                        case "success": e.fire({ icon: "success", title: a }); break;
                        case "info": e.fire({ icon: "info", title: a }); break;
                        case "warning": e.fire({ icon: "warning", title: a }); break;
                        case "error": e.fire({ icon: "error", title: a }); break;
                    }
                }
            } else { // Hiển thị thông báo 3 giây
                const e = Swal.mixin({
                    toast: true,
                    position: "top",
                    showConfirmButton: false,
                    timer: 2500,
                    didOpen: e => {
                        e.addEventListener("mouseenter", Swal.stopTimer);
                        e.addEventListener("mouseleave", Swal.resumeTimer);
                    }
                });
                switch (r) {
                    case "success": e.fire({ icon: "success", title: n }); break;
                    case "info": e.fire({ icon: "info", title: n }); break;
                    case "warning": e.fire({ icon: "warning", title: n }); break;
                    case "error": e.fire({ icon: "error", title: n }); break;
                }
            }
        } else { // Hiển thị thông báo 1.5 giây
            const e = Swal.mixin({
                toast: true,
                position: "top",
                showConfirmButton: false,
                timer: 1500,
                didOpen: e => {
                    e.addEventListener("mouseenter", Swal.stopTimer);
                    e.addEventListener("mouseleave", Swal.resumeTimer);
                }
            });
            switch (i) {
                case "success": e.fire({ icon: "success", title: s }); break;
                case "info": e.fire({ icon: "info", title: s }); break;
                case "warning": e.fire({ icon: "warning", title: s }); break;
                case "error": e.fire({ icon: "error", title: s }); break;
            }
        }
    });
}(jQuery); // Truyền jQuery vào IIFE